>----------------------------------------------------------------------<

>>>> 28 Sep. 2010:
        Version MAGIC3_44_28Sep2010 posted which
        implements the following minor corrections and new 
	features:

-- 28 Sep. 2010 -------------------------------------------------------

        1) Switching back to defining thread-private common-blocks in
           s_radialLooG.f. This seems to save memory, at least on the
           ALTIX

           CHANGED ROUTINES:
                s_radialLoopG.f


-- 31 Aug. 2010 -------------------------------------------------------

        1) Checking of buoyancy flux balance in s_preCalc.f and
           related output.
           When ABS(epsc0)=1 MAGIC assumes that the volumetric buoyancy
           sources define the buoyancy (temperature) scale.
           The buoyancy flux through the boundaries is then supposed
           to balance the source term. If flux conditions are chosen
           for both boundaries, the balance is checked and enforced
           in the following way: If the mean flux through the CMB
           is zero (default) the ICB flux is calculated to balance epsc0.
           If the mean flux through the CMB is given a non-zero value
           and the ICB flux is zero (default) the CMB flux is reset to
           balance epsc0. If both the ICB flux and the CMB flux are
           given non-zero values, MAGIC checks whether the balance of
           boundary flux and internal sources holds.
           Remember that the ICB and CMB flux are define by a list of
           quadrupols, for example s_top= l m ampR ampI, with
               l = spherical harmonic degree
               m = spherical harmonic order
               ampR = real part of amplitude
               ampI = imag. part of amplitude
           If is assumed that the normalisation of spherical harmonics Ylm
           is such that the surface integral over Ylm times is conjugate
           complex is 4*pi.

           If the user intends to use either the CMB of the ICB
           flux as a temperature scale, then the respective values
           should be specified (for example s_top= 0 0 1 0).
           If flux conditions are used for both boundies the user
           can either leave epsc0 at its default value (epsc0=0)
           or specify any epsc0.NE.0. If epsc0=0 it is reset to
           a value that balances the net buoyancy flux out of the
           system. If epsc0.NE.0 MAGIC checks whether the balance
           holds.

           In any case, the total flux through both boundaries as
           well as total volumetric sink/source are now written
           into the log file and you can chech whether the desired
           balance and/or ratio of volumetric buoyancy source to bottom
           buoyancy flux is met.

           CHANGED ROUTINES
                magic.f (order of preCalc and writeNamelists changed)
                s_writeInfo.f (non-dimensional ICB and CMB areas now
                               written into log-file)
                s_preCalc.f   (checking the balance, writing output)
                s_writeNamelists.f (writing the reset values for epsc0
                                    s_top, and s_bot)

        2) Correction in s_initS.f for impS.NE.0 and zero mean
           CMB heat flux.

           CHANGED ROUTINE
                s_initS.f


-- 27 Aug. 2010 -------------------------------------------------------

        1) Changed/corrected helicity output in s_outMisc.f. The output
           file mist.TAG now contains:
                helicit in NHS / rms in column 6
                helicit in SHS / rms in column 7
                equatorially anti-symmetric hel. / rms in column 8
                rms helicity in column 9

           CHANGED ROUTINE
                s_outMisc.f


-- 25 Aug. 2010 -------------------------------------------------------

        1) Correct output of time average force into file TOZM.tag.

           CHANGED ROUTINE
                s_outTO.f


-- 12 Aug. 2010 -------------------------------------------------------

        1) Fixes in s_mapData.f to care for the new inform=11/12
           This new inform is used to indicate that the restart
           file could contain a non-rotation case with the
           respective scaling (see below). This is indicated by
           an Ekman number ek=-1 in the rst.TAG file.

           CHANGED ROUTINE
                s_mapData.f

        2) Format definition of output into par-file corrected.

           CHANGED ROUTINE
                s_output.f


-- 4 Aug. 2010 -------------------------------------------------------

        1) Non-rotating case introduce which can be envoke with
           setting l_non_rot=.TRUE. in the control namelists or
           by setting Ek<0.

           This required some minor changes in the scaling of
           the magnetic field which is scaled with the rotation
           rate in the rotating case (see s_preCalc.f).
           I have used the chance to rename the factors used in
           front Coriolis froce, Lorentz force and buoyancy in
           the Navier-Stokes equation. The factor for the Coriolis
           force was oek=1/ek (ek=Ekman number) before and is now
           called CorFac which is CorFac=0 in the non-rotating case
           and CorFac=1/ek. The factor in front of the Lorentz
           force was oekpm=1/(ek prmag) (prmag=magnetic Prandtl nu.)
           before and is now called LFfac with LFfac=1/(ek prmag) in
           the rotating and LFfac=1 in the non-rotating case.
           The factor in front of the buoynacy force was
           rapr=ra/pr (ra=Rayleigh number, pr=Prandtl number) and
           is now calles BuoFac=ra/pr. This is all defined in s_preCalc.f
           I also too the chance to correct pScale in s_preCalc.f
           The factor LFfac is also used to convert the scale
           of the magnetic energy to that of the kinetic energy so
           that both are comparable.

           CHANGED ROUTINES:
                c_phys_param.f (CorFac,LFfac,RaFac stored)
                s_preCalc.f (factors calculated)
                s_get_td.f (CorFac used)
                s_get_power.f (LFfac used)
                s_get_nl.f    (LFfac used)
                s_get_e_mag.f (LFfac used for energy)
                s_getB0.f     (LFfac used for energy)
                s_spectrum_average.f (LFfac used for energy)
                s_spectrum.f (LFfac used for energy)
                s_getTO.f (CorFac used)
                s_outTO.f (LFfac used)
                s_horizontal.f (ampnu adapted)
                s_store_movie_frame_IC.f (LFfac used)
                s_store_movie_frame.f (LFfac used)
                s_courant.f (LFfac used)
                s_radial.f (BuoFac used)

        2) The output of Lorentz torque and viscous torque was done
           in a scaling not consistent with the other scaling in the
           code. This is now in line and the Lorentz torque in the
           equations for torque in IC and mantle is now
           multiplied with the proper LFfac also used elsewhere.

           CHANGED ROUTINES:
                s_output.f (scaling adjusted)
                s_get_lorentz_torque.f (no opm any more)
                s_get_viscous_torque.f (no ek any more)
                s_write_rot.f (scaling adjusted)
                s_getStartFields.f (scaling adjusted)
                s_updateZ.f (scaling adjusted)
                s_readStartFields.f (rescale old Lorentz torques)


-- 30 Jul. 2010 ------------------------------------------------------

        1) Correction of chosing radial levels for movie output.
           'R=0' was supposed to select the ICB but didn't do the
            job. The keyword 'ICB' now also directly selects the
            respective surface with r=r_ICB.

        CHANGED ROUTINE
                s_get_movie_type.f


--  9 Jul. 2010 ------------------------------------------------------

        1) Getting rid of the common block statements in s_radialLoopG.f.
           They are not really needed.

        CHANGED ROUTINE
                s_radialLoopG.f


--  6 Jul. 2010 ------------------------------------------------------

        1) Fixed inner core toroidal magnetic field in the G-file of
           the time averaged solution

        CHANGED ROUTINE
                s_get_drNS_even.f


--  2 Jul. 2010 ------------------------------------------------------

        1) Correction in call of get_e_mag in s_fields_average.f
           (Should not really have caused problems.)

        2) Introductin of intfac in analogy to courfac and alffac.
           infac is a safety factor which sets the maximum possible
           timestep to intfac*Ekman_number. Intfac should be smaller
           than one to guarantee that intertial waves are resolved.
           So far this had not been implemented properly.
           dtMax is now modified by the statement
                dtMax=MAX(dtMax,intfac*Ekman_number)
           in s_preCalc.f. A similar statement already existed (with infac=0.15)
           but did not work properly.

        CHANGED ROUTINES
                c_num_param.f
                s_readNamelists.f
                s_defaultNamelists.f
                s_writeNamelists.f
                s_preCalc.f


>>>> 7 May. 2010:
        Version MAGIC3_44_7May2010 posted which
        implements the following minor corrections:

--  7 May. 2010 ------------------------------------------------------


        1) Introduce CMB Elsasser number to standart output at end
           of log-file and in par-file.

        CHANGED ROUTINES
                c_const.f (store CMB surface)
                s_preCalc.f (calculation of CMB surface)
                s_get_e_mag.f (e_mag_cmb as new output)
                s_output.f (calculate, time average and output
                            CMB Elsasser number)

        2) Correction of error in field initialization:

        CHANGED ROUTINES
                s_getStartFields.f (parallel region for init routines
                                    and calculating radial derivatives
                                    was commented out and is reinstated now)
                s_initS.f (make sure that l=m=0 conductive profile is not
                           overwritten)


-- 20 Apr. 2010 ------------------------------------------------------

        1) Open misc files for SRIC and SRMA cases

        CHANGED ROUTINE
                s_openFiles.f


>----------------------------------------------------------------------<

>>>> 12 Apr. 2010:
        Version MAGIC3_44_12Apr2010 posted which
        implements the following minor corrections:


-- 12 Apr. 2010 ------------------------------------------------------

        1) Corrected output of total time averaged magnetic energy in
           log file

        CHANGED ROUTINE
                s_output.f


-- 5 Mar. 2010 ------------------------------------------------------

        1) Correction of output format in s_outMisc.f for
           l_save_out=.FALSE.

        CHANGED ROUTINE
                s_outMisc.f

        2) Corrected writing of header in kinetic energy spectrum file

        CHANGED ROUTINE
                s_spectrum.f

>----------------------------------------------------------------------<

>>>> 3 Mar. 2010:
        Version MAGIC3_44_3Mar2010 posted which
        implements the following minor corrections:

        1) rst-field close after start field have been read.

        CHANGED ROUTINE
                s_readStartFields.f

        2) Mapping of rst-field on new horizontal grid corrected.
        
        CHANGED ROUTINES
                s_mapData.f
                s_mapDataIC.f

>----------------------------------------------------------------------<

>>>> 24 Feb. 2010:
	Version MAGIC3_44_24Feb2010 posted which 
	implements the following minor corrections:

        1) Corrected suggestion of mapping factor in s_mapData.f and
        s_mapDataIC.f

        CHANGED ROUTINES
                s_mapData.f
                s_mapDataIC.f

        2) Definition of lm_max was missing in s_mapDataIC.f

        CHANGED ROUTINE
                s_mapDataIC.f

        3) Define zero in s_preCalc.f

        CHANGED ROUTINE
                s_preCalc.f


>----------------------------------------------------------------------<

>>>> 19 Feb. 2010: 
	New version MAGIC3_44_19Feb2010 posted

        MAGIC3_44 is based on MAGIC3_42_9Feb2010
        The version MAGIC3_44_19Feb2010 has been tested with 
        the BM2 and a chaotic case at E=3e-4 (SEL).
        The purpose of MAGIC3_44 is to clean up the 
        older versions and to make the code transparent. 
        In particular, the input and output to the
        individual routines has been clarified. Fewer 
        common blocks are used to 'transfere' data so
        that is clearer now what is used where and 
        where is comes from.
        Many comments have been added, in particular addressing
        parallelization issued in view of a future MPI version.
        The distribution of the arrays over the processors has 
        been cleaned up and is stated in the code, refering 
        to R-distributed and LM-distributed arrays for the 
        radial parallel region (s_radialLoopG.f) and the 
        parallel region over spherical harmonic modes
        (s_LMLoop.f), respectively.

        Nearly 80 of the approximately 200 subroutines have been
        touched with major changes in s_legPrepG.f, s_radialLoopG.f,
        s_output.f, s_LMLoop.f, s_updateB.f and s_updateS.f.
        Some subroutines have been added, others have vanished.
        The code is nevertheless basically still the same. 
        Feel free to contact me if you want to know details about
        the changes of particular subroutines.

        Due to the cleaning up of the memory and a better
        localization of the variables on the different 
        processors MAGIC3_44 may run faster than previous
        versions when several processors are employed.
        This remains to be tested.

        Compared to previous versions the output of the time averaged
        field into a G-file and of its spectra has been corrected. 
        Note that older version may also not support the usage of 
        a conducting inner core for stress free lower boundary
        conditions.

        Two text files have been added to the web-site:
        1) A list of the routines with a brief description what the do.
        2) A text on the usage of the different variables with a focus
           on parallelization issues.

	  JW, 19 Feb. 2010

--------------------------------------------------------------------->


>>>> 9 Feb. 2010
        New version MAGIC3_42_9Feb2009 posted

        It contains the following corrections/additions:

---- Nov. 6 2009 ---------------------------------------------------->

        1) Changes in averaging:
                Averages fields and spectra are now produced
                even when n_graphs=0 and n_specs=0.
                The only thing you have to do is setting l_average=.TRUE.
                The averaged fields and spetrac are now stored
                every 10th averaging step (every 10*n_log_step time step)
                so that you have a results even when the run crashes.
                In addition the potential fiels are stored plus the
                CMB magnetic field.

        CHANGED ROUTINES
                s_fields_average.f
                s_spectrum_average.f
                s_storePot.f
                s_storeTpot.f
                s_write_Bcmb.f

        2) Change in s_get_e_mag.f for the external dipole field
           ratio (column 16) so that this is not INF/NAN for
           zero (imposed) external field.

        CHANGED ROUTINE
                s_get_e_mag.f

        3) Change in s_outMisc.f so that the NaN values for
           the relative energies inside and outside the TC
           become zero when this is not calculated.
           I set Ekin=-1 for this.

        CHANGED ROUTINE
                s_outMisc.f

---- Nov. 10 2009 --------------------------------------------------->

        1) New output of relative equatorial anti-symmetric magnetic energy
           in s_get_e_mag.f, column 17 in dipole.TAG

        CHANGED ROUTINE
           s_get_e_mag.f


        2) New output of equatorially antisymmetric magnetic energy and
           equatorially symmetric kinetic energy and also the respective
           axially symmetric contributions
           in e_mag_oc.TAG (columns 8-11) and e_kin.TAG (columns 6-8).

        CHANGED ROUTINES
           s_get_e_mag.f
           s_get_e_kin.f

---- Jan. 20 2010

        Corrected output of relative equatorial (anti) symmetric energies
           (see changes from Nov. 10 2009)

        CHANGED ROUTINES
           s_get_e_mag.f
           s_get_e_kin.f


---- Feb. 9 2010

        Corrected automated ballancing of imposed boundary heat flux by
        internal sources/sinks. (see also MAGIC3_43)

        CHANGED ROUTINE
           s_preCalc.f

----------------------------------------------------------------------------------

>>>>> Previous posted versions:


	Jul. 23 2009
		corrected routine s_spectrum.f (in new MAGIC3_42.tar.gz)

	Jul. 21 2009:

>>>>>	New Version MAGIC3_42 ONLINE ON Jul. 21 2009

		NOTE: The manual is hopelessly outdated but still describes the 
		      main input parameters. There are, however, more output files 
	              and some files haves additional columns. These will be explained
	              in a later version of the manual. 
